{
  "entities": {
    "Client": {
      "title": "Client",
      "description": "Representa uma empresa cliente que utiliza os produtos da OptaRH. Originalmente 'Company'.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "O nome da empresa cliente."
        },
        "logoUrl": {
          "type": ["string", "null"],
          "description": "URL para o logo do cliente."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp de quando o cliente foi cadastrado."
        },
        "products": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["process_flow", "pulse_check"]
          },
          "description": "Lista de produtos que o cliente contratou."
        },
        "pulseCheckSettings": {
          "type": ["object", "null"],
          "description": "Configurações específicas para o produto PulseCheck.",
          "properties": {
            "allowAnonymous": {
              "type": "boolean",
              "description": "Define se as respostas às pesquisas podem ser anônimas."
            },
            "defaultSurveyDurationDays": {
              "type": "number",
              "description": "Duração padrão em dias para as pesquisas ativas."
            }
          }
        }
      },
      "required": ["name", "createdAt"]
    },
    "User": {
        "title": "User",
        "description": "Mapeia um usuário do Firebase Auth a um cliente, seus produtos e seu papel. Unifica 'master' e 'employee' roles sob o booleano 'isConsultant' ou futuras permissões.",
        "type": "object",
        "properties": {
            "clientId": {
                "type": "string",
                "description": "O ID do 'Client' (empresa) ao qual este usuário pertence."
            },
            "products": {
                "type": "array",
                "items": {
                    "type": "string",
                    "enum": ["process_flow", "pulse_check"]
                },
                "description": "Lista de produtos aos quais este usuário tem acesso."
            },
            "isConsultant": {
                "type": "boolean",
                "description": "Define se o usuário é um consultor (master) com acesso amplo ou um usuário padrão do cliente."
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "O email do usuário, para referência."
            },
            "name": {
              "type": ["string", "null"],
              "description": "O nome do usuário."
            },
            "department": {
              "type": ["string", "null"],
              "description": "Departamento do usuário dentro da empresa cliente."
            }
        },
        "required": ["clientId", "products", "isConsultant", "email"]
    },
    "Activity": {
      "title": "Activity",
      "description": "Representa uma tarefa ou atividade para o produto ProcessFlow.",
      "type": "object",
      "properties": {
        "nome": { "type": "string" },
        "categoria": { "type": ["string", "null"], "enum": ["DP", "RH", "Compartilhado", null] },
        "status": { "type": "string", "enum": ["brainstorm", "aguardando_consenso", "aprovada"] },
        "createdAt": { "type": "string", "format": "date-time" },
        "statusTransicao": { "type": "string", "enum": ["a_transferir", "em_transicao", "concluida"] },
        "justificativa": { "type": ["string", "null"] },
        "responsavel": { "type": ["string", "null"] },
        "recorrencia": { "type": ["string", "null"], "enum": ["Diária", "Semanal", "Mensal", "Trimestral", "Anual", "Sob demanda", null] },
        "dataAprovacao": { "type": ["string", "null"], "format": "date-time" },
        "parentId": { "type": ["string", "null"] }
      },
      "required": ["nome", "status", "createdAt", "statusTransicao"]
    },
    "Question": {
        "title": "Question",
        "description": "Representa uma única pergunta que pode ser reutilizada em diferentes pesquisas (surveys). Pode ser global ou específica de um cliente.",
        "type": "object",
        "properties": {
            "text": { 
              "type": "string", 
              "description": "O texto da pergunta (e.g., 'Em uma escala de 0 a 10...')." 
            },
            "type": { 
              "type": "string", 
              "enum": ["nps", "likert", "multiple-choice", "open-text"],
              "description": "O tipo de pergunta."
            },
            "category": { 
              "type": "string", 
              "description": "A categoria da pergunta para fins de agrupamento e análise (e.g., Liderança, Comunicação)." 
            },
            "options": { 
              "type": ["array", "null"], 
              "items": { "type": "string" }, 
              "description": "Array de opções para perguntas 'multiple-choice'." 
            },
            "order": {
                "type": "number",
                "description": "Ordem de exibição da pergunta dentro de sua categoria."
            },
            "isMandatory": {
                "type": "boolean",
                "description": "Define se a pergunta é de preenchimento obrigatório."
            },
            "isNpsQuestion": {
                "type": "boolean",
                "description": "Flag para identificar a pergunta principal de eNPS."
            },
            "isDefault": {
                "type": "boolean",
                "description": "Indica se é uma pergunta padrão do sistema."
            },
            "createdBy": {
              "type": "string",
              "description": "UID do consultor que criou a pergunta, ou 'system' para perguntas padrão."
            },
            "clientId": {
                "type": ["string", "null"],
                "description": "Se presente, indica que a pergunta é específica para este cliente. Se nulo, é uma pergunta global."
            },
            "createdAt": {
              "type": "string",
              "format": "date-time"
            }
        },
        "required": ["text", "type", "category", "order", "isMandatory", "createdBy", "createdAt"]
    },
    "Survey": {
        "title": "Survey",
        "description": "Representa uma pesquisa específica e ativa, enviada a uma empresa cliente.",
        "type": "object",
        "properties": {
            "title": { "type": "string", "description": "O título da pesquisa (e.g., 'Pesquisa de Clima Q3 2024')." },
            "description": { "type": "string", "description": "Uma breve descrição sobre o objetivo da pesquisa." },
            "clientId": { "type": "string", "description": "ID da empresa ('Client') para a qual a pesquisa se destina." },
            "status": { "type": "string", "enum": ["draft", "active", "closed"], "description": "O estado atual da pesquisa." },
            "questions": { 
              "type": "array", 
              "items": { "$ref": "#/entities/SelectedQuestion" }, 
              "description": "Um array de objetos de perguntas selecionadas para esta pesquisa."
            },
            "totalParticipants": {
              "type": "number",
              "description": "Número total de colaboradores que devem participar da pesquisa."
            },
            "isAnonymous": { "type": "boolean", "description": "Define se as respostas para esta pesquisa específica são anônimas ou identificadas." },
            "createdAt": { "type": "string", "format": "date-time" },
            "opensAt": { "type": "string", "format": "date-time", "description": "Data e hora em que a pesquisa se torna ativa e aceita respostas." },
            "closesAt": { "type": "string", "format": "date-time", "description": "Data e hora em que a pesquisa é fechada." }
        },
        "required": ["title", "clientId", "status", "questions", "isAnonymous", "createdAt", "opensAt", "closesAt"]
    },
     "SelectedQuestion": {
        "title": "SelectedQuestion",
        "description": "Representa uma instância de uma pergunta dentro de uma pesquisa específica.",
        "type": "object",
        "properties": {
            "id": { "type": "string", "description": "ID único da instância da pergunta na pesquisa." },
            "questionId": { "type": "string", "description": "ID da pergunta original na biblioteca." },
            "text": { "type": "string", "description": "O texto da pergunta no momento da seleção." },
            "type": { "type": "string", "enum": ["nps", "likert", "multiple-choice", "open-text"] },
            "category": { "type": "string" },
            "options": { "type": ["array", "null"], "items": { "type": "string" } },
            "isMandatory": { "type": "boolean" }
        },
        "required": ["id", "questionId", "text", "type", "category", "isMandatory"]
    },
    "Response": {
        "title": "Response",
        "description": "Armazena a resposta de um único colaborador a uma pesquisa completa.",
        "type": "object",
        "properties": {
            "surveyId": { "type": "string", "description": "ID da pesquisa ('Survey') à qual esta resposta pertence." },
            "clientId": { "type": "string", "description": "ID da empresa ('Client') para fácil filtragem dos resultados." },
            "respondentId": { "type": ["string", "null"], "description": "O UID do usuário que respondeu. É 'null' se a pesquisa for anônima." },
            "respondentToken": { "type": ["string", "null"], "description": "Identificador único para um respondente anônimo, para evitar múltiplas submissões." },
            "answers": { 
                "type": "object", 
                "additionalProperties": {
                    "type": "object",
                    "properties": {
                       "questionText": {"type": "string", "description": "Cópia do texto da pergunta no momento da resposta."},
                       "answer": {"type": ["string", "number"], "description": "A resposta fornecida pelo usuário (e.g., 10, 'Concordo', 'Opção A', 'Texto livre...')."}
                    },
                    "required": ["questionText", "answer"]
                },
                "description": "Um objeto onde as chaves são os IDs das perguntas ('questionId') e os valores são os objetos contendo a resposta."
            },
            "submittedAt": { "type": "string", "format": "date-time", "description": "Timestamp de quando a resposta foi enviada." },
            "startedAt": { "type": ["string", "null"], "format": "date-time", "description": "Timestamp de quando o usuário iniciou a resposta." }
        },
        "required": ["surveyId", "clientId", "answers", "submittedAt"]
    },
    "Suggestion": {
      "title": "Suggestion",
      "description": "Armazena uma sugestão de melhoria ou feedback do sistema enviada por um usuário.",
      "type": "object",
      "properties": {
        "text": {
          "type": "string",
          "description": "O conteúdo da sugestão enviada pelo usuário."
        },
        "userId": {
          "type": "string",
          "description": "O UID do usuário que enviou a sugestão."
        },
        "userEmail": {
          "type": "string",
          "format": "email",
          "description": "O email do usuário para referência."
        },
        "clientId": {
          "type": ["string", "null"],
          "description": "O ID do cliente ao qual o usuário pertence, se aplicável."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp de quando a sugestão foi enviada."
        },
        "status": {
          "type": "string",
          "enum": ["new", "in_review", "implemented", "declined"],
          "description": "O status atual da sugestão."
        }
      },
      "required": ["text", "userId", "userEmail", "createdAt", "status"]
    }
  },
  "auth": {
    "providers": ["password"]
  },
  "firestore": {
    "/clients/{clientId}": {
        "schema": { "$ref": "#/entities/Client" },
        "description": "Armazena informações sobre cada empresa cliente. Substitui a antiga 'companies'.",
        "subcollections": {
            "activities": {
                "path": "/clients/{clientId}/activities/{activityId}",
                "schema": { "$ref": "#/entities/Activity" },
                "description": "Atividades do ProcessFlow para um cliente específico."
            },
            "surveys": {
                "path": "/clients/{clientId}/surveys/{surveyId}",
                "schema": { "$ref": "#/entities/Survey" },
                "description": "Pesquisas do PulseCheck para um cliente específico."
            }
        }
    },
    "/users/{userId}": {
        "schema": { "$ref": "#/entities/User" },
        "description": "Mapeia Firebase Auth UIDs a clientes, produtos e permissões."
    },
    "/pulse_check_questions/{questionId}": {
        "schema": { "$ref": "#/entities/Question" },
        "description": "Repositório de perguntas para o PulseCheck. Contém perguntas globais (sem clientId) e perguntas específicas de clientes (com clientId)."
    },
    "/pulse_check_responses/{responseId}": {
        "schema": { "$ref": "#/entities/Response" },
        "description": "Coleção global para todas as respostas (anônimas ou identificadas). Separada para garantir que as regras de segurança permitam escrita anônima sem expor outras respostas."
    },
    "/system_suggestions/{suggestionId}": {
      "schema": { "$ref": "#/entities/Suggestion" },
      "description": "Coleção para armazenar sugestões e feedbacks sobre o sistema."
    }
  }
}
